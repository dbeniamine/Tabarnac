<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Tabarnac :  Tool for Analyzing the Behavior of Applications Running on NUMA ArChitecture">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Tabarnac</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/dbeniamine/Tabarnac">View on GitHub</a>

          <h1 id="project_title">Tabarnac</h1>
          <h2 id="project_tagline">Tools for Analyzing the Behavior of Applications Running on NUMA
ArChitecture</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/dbeniamine/Tabarnac/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/dbeniamine/Tabarnac/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="what-is-tabarnac" class="anchor" href="#what-is-tabarnac" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is tabarnac</h1>

<p><em>TABARNAC</em>: Tools for Analyzing the Behavior of Applications Running on NUMA
ArChitecture is a set of tools and methodologies to analyse performances
issues related to (NUMA) memory usage. Tabarnac consists on two parts:</p>

<ol>
<li>
<p>An efficient, lock-free instrumentation to trace the memory behavior at
the granularity of the page (based on a modified version of
<a href="https://github.com/matthiasdiener/numalize">numalize</a>). The
instrumentation tool is also able to retrieve data structure names, size
and address by two means:</p>

<ul>
<li>Binaries files are read using <code>libelfg0</code> to find statically allocated structures.</li>
<li>Mallocs are traced, and structure names are (heuristically) resolved using
debug flags.</li>
</ul>
</li>
<li><p>A set of simple yet complete visualization providing a deep understanding
of the memory usage.</p></li>
</ol>

<p>The two part of the tool are completely independent therefore it is possible to
run and analyze on different machines (see <a href="#advanced-usage">Advanced usage</a>).</p>

<p>The instrumentation is based on Intel's
<a href="https://software.intel.com/en-us/articles/pintool">Pin</a> library. Although Pin
is designed for Intel processor, it's still work on AMD.</p>

<p>The visualization is generated by <a href="http://cran.r-project.org/">R</a> and is able
to automatically install all the R libraries required.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<ul>
<li>Install the library gelf, <code>lstopo</code> and R (on Debian
<code>apt-get install libelfg0  hwloc r-base</code>, the two first are required for
instrumentation only and last is for visualization only).</li>
<li>Install <a href="https://software.intel.com/en-us/articles/pintool">Pin</a>.</li>
<li>Download Tabarnac
git clone <a href="https://github.com/dbeniamine/Tabarnac.git">https://github.com/dbeniamine/Tabarnac.git</a>
</li>
</ul>

<p>Everything should work out of the box !</p>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<h2>
<a id="instrumentation" class="anchor" href="#instrumentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instrumentation</h2>

<p>To instrument a program and generate the visualization, simply run:</p>

<pre><code>/path/to/tabarnac/tabarnac -- ./my_command my_arg0 my_arg1
</code></pre>

<p>It will generate 5 files and one directory:</p>

<pre><code>my_command.full.pages.csv
my_command.structs.csv
my_command.stackmap.csv
my_command-plots.html
advices.html
figure/
</code></pre>

<p>The three first files are generated by the instrumentation and are not designed
to be read by an human, it gives (respectively) the number of access per page
and per threads, the addresses of the different data structures, the addresses
of each stack.</p>

<h3>
<a id="visualization" class="anchor" href="#visualization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Visualization</h3>

<p>The file <code>my_commands-plots.html</code> contains the actual visualization of the
trace it consist on a set of plots coupled with explanation to ease their
reading.</p>



<p>The first figure is the topology of the analysis machine, generated by
<code>lstopo</code>.</p>

<p>The two following visualization show the size and the number of reads and
writes for each data structure. They aim at understanding the relative
importance of each structure and give a small insight of which kind of
optimisation can be done for each structure (replication, splitting ...). A
tables also shows which structures are not read (or written) by which threads,
this is useful to determine if replication is a possible optimisation.</p>

<p>Then Tabarnac shows for each data structure the access distribution of each
thread. This visualization gives a deep understanding of the data sharing
between threads and allow the user to find a good NUMA data / thread mapping
or to decide to modify this pattern.</p>

<p>Finally as in most operating systems, memory pages are mapped near to the
first thread accessing them (first touch), we provide for each structure a
plot showing which thread is responsible of the first touch on each page. To
obtain the best performances, the first touch should pattern should be
correlated to the access distribution. If it is impossible, manual or
automatic data mapping should provide huge performances improvements.</p>

<h1>
<a id="advanced-usage" class="anchor" href="#advanced-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced usage</h1>

<p>It is often easier / preferable to install avoid installing to much things on
experimental machines, therefore Tabarnac allow you to run and generate the
visualisation on different machines.</p>

<h2>
<a id="run-only" class="anchor" href="#run-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run only</h2>

<p>To only run the instrumentation on a machine run:</p>

<pre><code>/path/to/tabarnac/tabarnac -r -- ./my_command my_arg0 my_arg1
</code></pre>

<p>Save the <code>*.csv</code> and <code>topo.png</code>  to the machine on which you like to run the
visualization.</p>

<h2>
<a id="visualize-only" class="anchor" href="#visualize-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>Visualize only</h2>

<p>To generate the visualization, got to the directory containing the files
previously generated and run:</p>

<pre><code>/path/to/tabarnac/tabarnac -p my_command
</code></pre>

<p>A few options are available to customize the plots:</p>

<pre><code>-i            Do not ignore smally used structures. This might
                        produce a hard to read output
-b            Do black and white plots
-s            Save plots (png files)
-t            Disable titles in figures
-S scale      Set the scale for saved figures implies -s
-R ratio      set plots_width=ratio*plot_height, default=1
</code></pre>

<h1>
<a id="troubleshooting" class="anchor" href="#troubleshooting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Troubleshooting</h1>

<h2>
<a id="pin-installation" class="anchor" href="#pin-installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pin installation</h2>

<p>If pin is not installed in <code>/opt/pin</code>, you might got the following error:</p>

<pre><code>/bin/sh: 1: /opt/pin: not found
</code></pre>

<p>You can fix it either by setting <code>PIN_HOME</code> to the pin installation path</p>

<pre><code>export PIN_HOME=/path/to/pin
</code></pre>

<p>Or by directly giving the pin path to Tabarnac:</p>

<pre><code> /path/to/tabarnac/tabarnac -d /path/to/pin -- ./my_command my_arg0 my_arg1
</code></pre>

<h3>
<a id="debug-flag-not-present-warning" class="anchor" href="#debug-flag-not-present-warning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Debug flag not present warning</h3>

<p>Although your application is compile with the <code>-g</code> flag, Tabarnac might show
the following warning:</p>

<pre><code>Can't open file '', malloc will be anonymous
Have you compiled your program with '-g' flag ?
</code></pre>

<p>This happens when the application is linked to a library compiled without the
debug flags, it only means that structures allocated on the library won't be
analyzed.</p>

<h1>
<a id="authors" class="anchor" href="#authors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors</h1>

<p>Tabarnac is the results of an international collaboration between <a href="http://matthiasdiener.github.io/">Matthias
Diener</a> (<a href="http://www.ufrgs.br">UFRGS</a>,
Brasil) and <a href="http://moais.imag.fr/membres/david.beniamine/">David Beniamine</a>
(<a href="http://www.univ-grenoble-alpes.fr/">Univ. Grenobles Alpes</a>, France).</p>

<p>We are grateful to <a href="http://www.campusfrance.org">CAMPUS France</a> who financed
this project.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Tabarnac maintained by <a href="https://github.com/dbeniamine">dbeniamine</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
